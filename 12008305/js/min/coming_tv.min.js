"use strict";function _possibleConstructorReturn(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}();!function(t){function e(n){if(i[n])return i[n].exports;var a=i[n]={i:n,l:!1,exports:{}};return t[n].call(a.exports,a,a.exports,e),a.l=!0,a.exports}var i={};e.m=t,e.c=i,e.d=function(t,i,n){e.o(t,i)||Object.defineProperty(t,i,{configurable:!1,enumerable:!0,get:n})},e.n=function(t){var i=t&&t.__esModule?function(){return t["default"]}:function(){return t};return e.d(i,"a",i),i},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=1)}([function(t,e,i){i.d(e,"a",function(){return n});var n=function(){function t(e){_classCallCheck(this,t);var i=e.position,n=e.parent,a=e.lib,s=void 0===a?"lib":a,o=e.img,h=void 0===o?"images":o,r=e.index,c=void 0===r?0:r;this.shortpants=!1,this.callaction=null,this.cjs=null,this.lib=s,this.img=h,this.index=c,this.shadow_flg=!1,this.images_backup={},this.getParent=function(){return n},this.getPosition=function(){return parseInt(i)}}return _createClass(t,[{key:"isShortpants",value:function(t){var e=!1,i=this.getParent().cloth_data[t];if(i)for(var n in i)"replace_leg_L_front"==n&&(e=!0);this.shortpants=e}},{key:"init",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];for(var e in this.image_url_list)e.indexOf("costume")>-1&&this.isShortpants(e);var i={};for(var n in this.image_url_list)for(var a in this.getParent().cloth_data[n]){if(n.indexOf("costume")>-1){if((2==this.breast_size||3==this.breast_size)&&"replace_breast_L"==a)continue;if((1==this.breast_size||3==this.breast_size)&&"replace_breast_S"==a)continue}if(n.indexOf("leg")>-1)if(this.shortpants){if("replace_item_foot_L_back"==a)continue}else if("replace_item_foot_L_front"==a)continue;i[a]=this.getParent().cloth_data[n][a]}var s=this.getParent().cloth_data["cheek"+(4==this.body_type?1:this.body_type)];for(var o in s)i[o]=s[o];this.runCjs(i,t,this.img,this.index)}},{key:"getVariables",value:function(){return{small_character_flg:2==this.body_type?1:0,big_character_flg:4==this.body_type?1:0,chara_num:this.getParent().getCharacterLength(),chara_order:this.getPosition(),shadow_flg:this.shadow_flg}}},{key:"changeOption",value:function(t){t||(t=this.getVariables()),this.cjs[this.swf].init(t)}},{key:"doAction",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";this.cjs[this.swf].motion_set(t)}},{key:"runCjs",value:function(t,e,i,n){var a=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],s=this.getParent();s.clearImages(),$.extend(window[i],t),$.extend(this.images_backup,t);var o=window[this.lib][this.swf];this.cjs=new o,this.cjs.visible=a,s.stage.addChildAt(this.cjs,n),s.stage.update(),this.changeOption(),e&&e.resolve()}},{key:"cloneTo",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.getParent().clearImages(),$.extend(window[this.img],this.images_backup);var i=window[this.lib][this.swf],n=new i,a=this.getVariables();return null==e?t.addChild(n):t.addChildAt(n,e),t.update(),n[this.swf].init(a),n}}]),t}()},function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0});var n=i(2),a=function(){function t(e){var i=this;_classCallCheck(this,t);var a=this;for(var s in e)this[s]=e[s];var o=window.petitManager||new n["a"],h=window.canvasManager||new Commonjs.Canvas;window.petitManager=o,window.canvasManager=h,this.storyContainer=".story-container",this.commentContainer=".comment-container",this.$commentDisplay=$(this.commentContainer+" > span"),this.commentDisplayName="comment",this.btnNextLine=".showNextLine",this.btnNextLineName="showNextLine",this.$btnShowNextLine=$(".showNextLine"),this.btnNextScene=".btn-nextscene",this.btnNextsceneName="btn-nextscene",this.showArrowName="showArrow",this.cjsContainer=".cjs-container",this.bgContainer=".bg-container",this.curtainContainer=".curtain-container",this.eyecatch="#jsEyeCatch",this.isMonitorModeName="isMonitorMode",this.isFinishedName="isFinished",this.scene=0,this.speed=60,this.delay=300,this.line=0,this.guest_num=Object.keys(this.data.idol_avatar).length,this.mode=1,this.stageItems={},this.monitorItems={},this.charaManager={},this.audienceManager,this.pinyaManager,this.balloonManager,this.nameplateManager,this.audienceParam={chara_num:this.guest_num,mode:this.mode},this.pinyaParam={chara_num:this.guest_num,mode:this.mode,motion_finish_callback:function(){window.comingTv.pinya_motion_finished=!0,window.comingTv.readyNextScene()}},this.balloonParam={chara_num:this.guest_num,mode:this.mode,speak_type:1,position1_talk:0,position2_talk:0,position3_talk:0,position4_talk:0,position5_talk:0,position0_talk:0,position9_talk:0,motion_finish_callback:function(){window.comingTv.balloon_motion_finished=!0,window.comingTv.playComment()}},this.nameplateParam={chara_num:this.guest_num,mode:this.mode,position1_talk:0,position2_talk:0,position3_talk:0,position4_talk:0,position5_talk:0,position0_talk:0,position9_talk:0,position1_charaid:0,position2_charaid:0,position3_charaid:0},this.namePlateHideParam={position0_hide:0,position1_hide:1,position2_hide:1,position3_hide:1,position4_hide:1,position5_hide:1,position9_hide:1},this.stayMotions={stay:1,stay_sit:1,out:1},this.guest_motion_counter=0,this.mc_motion_finished=!1,this.guest_motion_finished=!1,this.pinya_motion_finished=!1,this.comment_finished=!1,this.autoNext=!1,this.isGuestsStaged=!1,this.guestStagedScene=0,this.isPinyaItemRemoved=!1;for(var r in this.data.idol_avatar)this.data.idol_avatar[r].swf="cjs001_petit_test";this.mc.swf="cjs002_petit_nana",o.requireCJS(this.cjs_file).done(function(){var t=a.data.idol_avatar;t["mc"]=a.mc,o.setAnotherCharacter("mc"),o.setCharacters(t);for(var e in i.data.idol_avatar)i.charaManager[e]=o.getChracter(e);var n=void 0,s=void 0,r=void 0,c=void 0;h.init(o.canvas,i.manifest.balloon,lib,null,18,function(){n=h.addChild("cjs005_balloon")},!1,o.stage),h.init(o.canvas,i.manifest.nameplate,lib,null,18,function(){s=h.addChild("cjs006_nameplate")},!1,o.stage),h.init(o.canvas,i.manifest.pinya,lib,null,18,function(){r=h.addChild("cjs004_pinya")},!1,o.stage),h.init(o.canvas,i.manifest.audience,lib,null,18,function(){c=h.addChild("cjs003_audience")},!1,o.stage),i.balloonCjs=n,i.nameplateCjs=s,i.pinyaCjs=r,i.audienceCjs=c,i.balloonManager=n.cjs005_balloon,i.audienceManager=c.cjs003_audience,i.pinyaManager=r.cjs004_pinya,i.nameplateManager=s.cjs006_nameplate,o.canvas.width=1280;var l=i.manifest["interior"][i.guest_num];for(var d in l){var m=new Image;m.src=l[d],m.width=320,m.height=420,i.stageItems[d]=new createjs.Bitmap(m)}var u=i.monitor_item_list||[];u["frame"]=i.bg_list[99];for(var _ in u){var g=new Image;g.src=u[_],g.width=320,g.height=210,i.monitorItems[_]=new createjs.Bitmap(g)}}),o.loaded_action=function(){var t=o.getAllChracter();i.guest_num>3&&(h.stage.addChild(t[5].cjs),h.stage.addChild(t[4].cjs)),h.stage.addChild(i.stageItems["sofa_guests"]),h.stage.addChild(t[1].cjs),i.guest_num>1&&h.stage.addChild(t[2].cjs),i.guest_num>2&&h.stage.addChild(t[3].cjs),h.stage.addChild(i.stageItems["sofa_mc"]),h.stage.addChild(t["mc"].cjs),h.stage.addChild(i.stageItems["table"]),h.stage.addChild(i.nameplateCjs);for(var e in i.monitorItems)h.stage.addChild(i.monitorItems[e]),i.monitorItems[e].visible=!1;h.stage.addChild(i.balloonCjs),h.stage.addChild(i.pinyaCjs),h.stage.addChild(i.audienceCjs),$(window.comingTv.eyecatch).hide(),window.comingTv.initReady()}}return _createClass(t,[{key:"initReady",value:function(){this.setBg(),this.audienceManager.init(this.audienceParam),this.pinyaManager.init(this.pinyaParam),this.balloonManager.init(this.balloonParam),this.nameplateManager.init(this.nameplateParam),this.nameplateManager.hide_manage(this.namePlateHideParam),this.setCharaAllMotion(),this.initCommenter(),0==this.getGuestCallbackMotionNum()&&(this.guest_motion_counter=0,this.guest_motion_finished=!0),this.detail[this.scene].message?this.setComment():(this.comment_finished=!0,this.readyNextScene()),this.detail[this.scene].audience&&setTimeout(function(){window.comingTv.audienceManager.run_effect()},this.delay),this.detail[this.scene].pinya_id||(this.pinya_motion_finished=!0,this.readyNextScene())}},{key:"initCommenter",value:function(){var t=this;this.commenter=$(this.storyContainer).comment_timer({click:this.btnNextLineName,speed:this.speed,call:function(){t.commentCallback()}})}},{key:"setBg",value:function(t){$(this.bgContainer).empty();var e=new Image;e.width=320,e.height=420,$(this.bgContainer).append(e);var i=t||this.detail[this.scene];e.src=this.bg_list[i.bg_image]}},{key:"setCurtain",value:function(t){"close"==t?$(this.curtainContainer).css("display","block"):"open"==t&&$(this.curtainContainer).fadeOut(this.delay,function(){window.comingTv.readyNextScene()})}},{key:"isModeChanged",value:function(){var t=this.detail[this.scene-1],e=this.detail[this.scene];return e.bg_image-t.bg_image==-this.guest_num?(this.updateMode(2),!0):e.bg_image-t.bg_image==this.guest_num&&(this.updateMode(1),!0)}},{key:"updateMode",value:function(t){this.mode=t,this.audienceParam.mode=t,this.pinyaParam.mode=t,this.balloonParam.mode=t,this.nameplateParam.mode=t,window.petitManager.setMode(t)}},{key:"setModeChangedView",value:function(){if(this.setCurtain("close"),this.setBg(),this.setNameplateHideOptions(this.scene+1),this.nameplateManager.init(this.nameplateParam),this.nameplateManager.hide_manage(this.namePlateHideParam),this.audienceManager.init(this.audienceParam),this.balloonManager.init(this.balloonParam),2==this.mode){for(var t in this.stageItems)this.stageItems[t].visible=!1;this.monitorItems["frame"].visible=!0,this.monitorItems[this.scene]&&(this.monitorItems[this.scene].visible=!0),this.setCharaAllMotion(this.scene+1,"stay"),this.setNameplatePosition(this.scene+1),this.pinyaManager.visible&&!this.isPinyaItemRemoved&&(this.pinyaManager.visible=!1),$(this.commentContainer).addClass(this.isMonitorModeName)}else{for(var e in this.stageItems)this.stageItems[e].visible=!0;for(var i in this.monitorItems)this.monitorItems[i].visible=!1;this.setCharaAllMotion(this.scene),$(this.commentContainer).removeClass(this.isMonitorModeName),this.pinyaManager.visible||this.isPinyaItemRemoved||(this.pinyaManager.visible=!0)}setTimeout(function(){window.comingTv.comment_finished=!0,window.comingTv.mc_motion_finished=!0,window.comingTv.guest_motion_finished=!0,window.comingTv.pinya_motion_finished=!0,window.comingTv.setCurtain("open")},this.delay)}},{key:"setCharaAllMotion",value:function(t,e){var i=t||this.scene,n="";for(var a in this.data.idol_avatar)n=e||this.detail[i]["motion_"+a],this.charaManager[a].changeMotion(n),2==this.mode&&this.charaManager[a].changePosition(parseInt(this.detail[i]["position_"+a]),n)}},{key:"setNameplatePosition",value:function(t){for(var e=t||this.scene,i=this.detail[e],n=1;n<this.guest_num+1;n++)i["position_"+n]&&(this.nameplateParam["position"+i["position_"+n]+"_charaid"]=n)}},{key:"setNameplateHideOptions",value:function(t){var e=t||this.scene,i=this.detail[e];if(this.namePlateHideParam["position1_hide"]=1,this.namePlateHideParam["position2_hide"]=1,this.namePlateHideParam["position3_hide"]=1,this.namePlateHideParam["position4_hide"]=1,this.namePlateHideParam["position5_hide"]=1,this.namePlateHideParam["position0_hide"]=0,this.namePlateHideParam["position9_hide"]=1,2==this.mode)for(var n=1;n<this.guest_num+1;n++)i["position_"+n]&&(this.namePlateHideParam["position"+i["position_"+n]+"_hide"]=0);else for(var a in this.data.idol_avatar)this.namePlateHideParam["position"+a+"_hide"]=0}},{key:"pinyaCallback",value:function(t){var e=this.detail[this.scene].pinya_info["image"],i=this.pinya_img_url,n=i.replace("XXX_replace_pinya_item_XXX.png",e);this.manifest["pinya"][1]["src"]=n;var a=window.canvasManager,s=window.petitManager,o=void 0;a.init(s.canvas,this.manifest.pinya,lib,null,18,function(){o=a.addChild("cjs004_pinya")},!1,s.stage),a.stage.addChild(this.audienceCjs),s.stage.update(),this.pinyaCjs=o,this.pinyaManager=o.cjs004_pinya,this.pinyaManager.init(this.pinyaParam),this.pinyaManager.run_motion(t)}},{key:"commentCallback",value:function(){this.line++,this.comment_list[this.line]?(this.$commentDisplay.removeClass(this.commentDisplayName).eq(this.line).addClass(this.commentDisplayName).data("comment",this.comment_list[this.line]),this.$btnShowNextLine.trigger("click")):(this.comment_finished=!0,this.readyNextScene())}},{key:"setCommentList",value:function(t){return!!t&&(this.comment_list=t,!0)}},{key:"setComment",value:function(){var t=this.detail[this.scene];for(var e in this.data.idol_avatar)"mc"==e?(this.balloonParam["position0_talk"]=parseInt(t["message_arrow_mc"])||0,this.nameplateParam["position0_talk"]=parseInt(t["message_arrow_mc"])||0):2!=this.mode?(this.balloonParam["position"+e+"_talk"]=parseInt(t["message_arrow_"+e])||0,this.nameplateParam["position"+e+"_talk"]=parseInt(t["message_arrow_"+e])||0):(this.balloonParam["position"+t["position_"+e]+"_talk"]=parseInt(t["message_arrow_"+e])||0,this.nameplateParam["position"+t["position_"+e]+"_talk"]=parseInt(t["message_arrow_"+e])||0);this.balloonParam["speak_type"]=parseInt(t.message_window_type)||1,this.balloonManager.init(this.balloonParam),this.balloonManager.run_talk(this.balloonParam),this.setCommentList(t.message.split(/\n/)),2==this.mode&&this.setNameplatePosition(),this.nameplateManager.run_talk(this.nameplateParam)}},{key:"playComment",value:function(){this.$commentDisplay=$(this.commentContainer+" > span"),this.$commentDisplay.eq(this.line).addClass(this.commentDisplayName).data("comment",this.comment_list[this.line]),this.$btnShowNextLine||(this.$btnShowNextLine=$(this.btnNextLine)),this.line!=this.comment_list.length&&this.$btnShowNextLine.trigger("click")}},{key:"setAllComment",value:function(){if(this.balloon_motion_finished){this.$commentDisplay.data("comment","").removeClass(this.commentDisplayName);var t=window.comment_timer_arr;if(t){for(var e in t)clearInterval(t[e]);for(var e in this.$commentDisplay)this.$commentDisplay.eq(e).text(this.comment_list[e]);this.line=this.comment_list.length,setTimeout(function(){window.comingTv.comment_finished=!0,window.comingTv.readyNextScene()},this.delay)}this.balloon_motion_finished=!1}else $(this.btnNextScene).attr("id","showAll")}},{key:"getGuestCallbackMotionNum",value:function(){var t=0;for(var e in this.data.idol_avatar)"mc"!=e&&void 0==this.detail[this.scene]["motion_"+e]&&(this.detail[this.scene]["motion_"+e]in this.stayMotions||t++);return t}},{key:"checkGuestMotionFinished",value:function(){++this.guest_motion_counter==this.getGuestCallbackMotionNum()&&(this.guest_motion_counter=0,this.guest_motion_finished=!0)}},{key:"guest_motion_finish_callback",value:function(){this.isGuestsStaged||(this.guestStagedScene=this.scene),this.isGuestsStaged=!0,this.checkGuestMotionFinished(),this.readyNextScene()}},{key:"mc_motion_finish_callback",value:function(){this.mc_motion_finished=!0,this.readyNextScene()}},{key:"readyNextScene",value:function(){if(this.guest_motion_finished&&this.mc_motion_finished&&this.comment_finished&&this.pinya_motion_finished){if(this.isGuestsStaged&&this.guestStagedScene==this.scene){for(var t in this.data.idol_avatar)this.namePlateHideParam["position"+t+"_hide"]=0;this.nameplateManager.hide_manage(this.namePlateHideParam)}if(this.detail[this.scene].auto_next)return this.mc_motion_finished=!1,this.guest_motion_finished=!1,this.comment_finished=!1,this.pinya_motion_finished=!1,this.autoNext=!0,setTimeout(function(){window.comingTv.changeNext(),window.comingTv.autoNext=!1},this.delay),!1;if($(this.btnNextScene).attr("id","next").addClass(this.showArrowName),this.mc_motion_finished=!1,this.guest_motion_finished=!1,this.comment_finished=!1,this.pinya_motion_finished=!1,void 0==this.detail[this.scene+1]){$("<a />").attr({href:this.return_url,class:this.isFinishedName}).appendTo(this.cjsContainer)}}}},{key:"changeNext",value:function(){if(void 0==this.detail[this.scene])return!1;$(this.btnNextScene).removeClass(this.showArrowName),this.autoNext||this.$commentDisplay.text("").removeClass(this.commentDisplayName),this.scene++,this.line=0;var t=this.detail[this.scene];if(this.isModeChanged())return this.setModeChangedView(),!1;0==this.getGuestCallbackMotionNum()&&(this.guest_motion_counter=0,this.guest_motion_finished=!0),""==t["motion_mc"]&&(this.mc_motion_finished=!0);for(var e in this.data.idol_avatar)""!=t["motion_"+e]&&("mc"==e||this.isGuestsStaged||(this.charaManager[e].cjs.visible=!0),this.charaManager[e].changeMotion(t["motion_"+e]));if(t.message?($(this.btnNextScene).attr("id","showAll"),this.setComment()):(this.comment_finished=!0,this.autoNext||(this.balloonManager.visible=!1)),t.audience&&setTimeout(function(){window.comingTv.audienceManager.run_effect()},this.delay),t.monitor&&(this.monitorItems[this.scene].visible=!0),t.pinya_id){var i=t.pinya_id>0?1:0;i?this.pinyaCallback(i):(this.pinyaManager.run_motion(i),this.isPinyaItemRemoved=!0,this.pinya_motion_finished=!0)}else this.pinya_motion_finished=!0}}]),t}();window.ComingTv=a},function(t,e,i){i.d(e,"a",function(){return o});var n=i(3),a=i(4),s=i(5),o=function(t){function e(){var t;_classCallCheck(this,e);var i={},n=(t=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,i)),1),a=[];return t.setMode=function(e){n=e,t.changeOption()},t.getMode=function(){return parseInt(n)},t.setAnotherCharacter=function(t){$.inArray(t,a)>-1||a.push(t)},t.getAnotherLength=function(){return a.length},t}return _inherits(e,t),_createClass(e,[{key:"init",value:function(t){if(this.deleteQue.length){for(var e in this.deleteQue)this.deleteCharacter(this.deleteQue[e]);this.deleteQue.splice(0,this.deleteQue.length)}for(var i in t)if(void 0==t[i].cjs){var n=null;switch(i){case"mc":n=new s["a"]({position:i,parent:this,lib:"lib2",img:"images",index:0});break;default:n=new a["a"]({position:i,parent:this,index:0})}t[i]=$.extend(n,t[i])}this.initReady(t)}},{key:"ready",value:function(t){var e=this,i=[];Object.keys(t).forEach(function(e){var n=$.Deferred();t[e].init(n),i.push(n.promise())}),$.when.apply($,i).then(function(){"function"==typeof e.loaded_action&&(window.characters=t,e.loaded_action())})}}]),e}(n["a"])},function(t,e,i){i.d(e,"a",function(){return a});var n=i(0),a=function(){function t(e){var i=this;_classCallCheck(this,t);var n=e||{};this.cloth_data={},this.el="#animation-container",this.$el=null,this.prefetch=null,this.loaded_action=null,this.deleteQue=[],this.headDOM=document.getElementsByTagName("head")[0],this.fps=18,this.stage=null,this.images={},this.canvas_width=640,this.canvas_height=840,this.canvas_id="",this.getCharacterLength=function(){return i.getCharactersKeys().length},this.getCharactersKeys=function(){return Object.keys(n)},this.setCharacters=function(t,e){if("object"!=typeof t)return!1;for(var a in t){var s=$.extend({},t[a]);n[a]=s}return!!e||(i.initCharacters(),!0)},this.initCharacters=function(){i.init(n)},this.deleteCharacter=function(t){return void 0!=n[t]&&(void 0!=n[t].api&&n[t].delPex(),delete n[t],!0)},this.changeOption=function(){for(var t in n)n[t].changeOption()},this.getChracter=function(t){return void 0===t?n:n[t]},this.getAllChracter=function(){return n}}return _createClass(t,[{key:"requireCJS",value:function(t){var e=this;window.images=this.images;var i=$.Deferred();return requirejs(["easeljs_0_7_1","tweenjs"],function(){requirejs(["movieclipjs"],function(){requirejs(t,function(){e.elementsInitialize(),e.stage=new createjs.Stage(e.canvas),createjs.Ticker.setFPS(e.fps),createjs.Ticker.addEventListener("tick",function(){e.stage.update()}),i.resolve()})})}),i.promise()}},{key:"clearImages",value:function(){for(var t in this.images)delete this.images[t]}},{key:"init",value:function(t){if(this.deleteQue.length){for(var e in this.deleteQue)this.deleteCharacter(this.deleteQue[e]);this.deleteQue.splice(0,this.deleteQue.length)}for(var i in t)if(void 0==t[i].cjs){var a=new n["a"]({position:i,parent:this,lib:"lib",img:"images"});t[i]=$.extend(a,t[i])}this.initReady(t)}},{key:"cjsStop",value:function(){createjs.Ticker.setPaused(!0),createjs.Ticker.reset()}},{key:"elementsInitialize",value:function(){this.$el||(this.$el=$(this.el),this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas_width,this.canvas.height=this.canvas_height,this.canvas.id=this.canvas_id,this.$el.append(this.canvas))}},{key:"setPrefetch",value:function(){if(!this.prefetch){var t=document.getElementById("prefetch");t||(t=document.createElement("div"),t.id="prefetch",this.headDOM.appendChild(t)),this.prefetch=t}}},{key:"initReady",value:function(t){this.clothMerge(t)}},{key:"clothMerge",value:function(t){var e={};for(var i in t)$.extend(e,t[i].image_url_list);for(var n=1;n<=3;n++)e["cheek"+n]="";this.loadClothData(e,t)}},{key:"loadClothData",value:function(t,e){var i=this,n=[];for(var a in t){var s=$.Deferred();n.push(s.promise()),void 0===this.cloth_data[a]?void 0!==window[a]?this.imageAlready(a,window[a],s):this.loadImageJs(t[a],a,s):s.resolve()}$.when.apply($,n).then(function(){$(i.prefetch).empty(),i.ready(e)})}},{key:"loadImageJs",value:function(t,e,i){var n=this,a=document.createElement("script");a.onload=function(){n.imageAlready(e,window[e],i)},a.src=t,this.headDOM.appendChild(a)}},{key:"imageAlready",value:function(t,e,i){var n=[];for(var a in e){var s=$.Deferred();n.push(s),this.cloth_data[t]=[],this.imageToReplace(t,e[a],a,s)}$.when.apply($,n).then(function(){i.resolve()})}},{key:"imageToReplace",value:function(t,e,i,n){var a=this,s=new Image;s.onload=function(){a.cloth_data[t][i]=s,n.resolve()},s.src=e,this.setPrefetch(),this.prefetch.appendChild(s)}},{key:"ready",value:function(t){var e=this,i=[];for(var n in t){var a=$.Deferred();t[n].init(a),i.push(a.promise())}$.when.apply($,i).then(function(){"function"==typeof e.loaded_action&&e.loaded_action()})}}]),t}()},function(t,e,i){i.d(e,"a",function(){return a});var n=i(0),a=function(t){function e(t){_classCallCheck(this,e);var i=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t)),n="stay";return i.changeMotion=function(t){n=t,i.doAction(n)},i.getMotion=function(){return n},i.changePosition=function(t,e){var n=i.getVariables();n.chara_order=t,n.motion_act=e,i.changeOption(n)},i}return _inherits(e,t),_createClass(e,[{key:"runCjs",value:function(t,e,i,n){var a=(!(arguments.length>4&&void 0!==arguments[4])||arguments[4],this.getParent());a.clearImages(),$.extend(window[i],t),$.extend(this.images_backup,t);var s=window[this.lib][this.swf];this.cjs=new s,a.stage.addChildAt(this.cjs,n),a.stage.update(),this.changeOption(),e&&e.resolve(),this.cjs.visible=!1}},{key:"getVariables",value:function(){var t=this.getParent();return{small_character_flg:2==this.body_type?1:0,big_character_flg:4==this.body_type?1:0,chara_num:t.getCharacterLength()-t.getAnotherLength(),chara_order:this.getPosition(),motion_act:this.getMotion(),mode:t.getMode(),motion_finish_callback:function(t,e){window.comingTv.guest_motion_finish_callback()}}}}]),e}(n["a"])},function(t,e,i){i.d(e,"a",function(){return a});var n=i(0),a=function(t){function e(t){_classCallCheck(this,e);var i=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t)),n="stay";return i.changeMotion=function(t){n=t,i.doAction(n)},i.getMotion=function(){return n},i.changePosition=function(t,e){},i}return _inherits(e,t),_createClass(e,[{key:"getVariables",value:function(){var t=this.getParent();return{chara_num:t.getCharacterLength()-t.getAnotherLength(),motion_act:this.getMotion(),mode:t.getMode(),motion_finish_callback:function(t){window.comingTv.mc_motion_finish_callback()}}}}]),e}(n["a"])}]);